æœm3u8ä»€ä¹ˆéƒ½æ²¡æœ‰
å¦‚æœæœä¸åˆ°m3u8æ–‡ä»¶ï¼Œè¯´æ˜è…¾è®¯è§†é¢‘å¯èƒ½ä½¿ç”¨äº†å…¶ä»–æŠ€æœ¯æ¥ä¿æŠ¤è§†é¢‘ã€‚è®©æˆ‘æä¾›å‡ ç§æ›¿ä»£æ–¹æ¡ˆï¼š
ğŸ”§ æ–¹æ¡ˆ1ï¼šä½¿ç”¨æµè§ˆå™¨æ’ä»¶ï¼ˆæœ€ç®€å•ï¼‰
å®‰è£…è§†é¢‘ä¸‹è½½æ’ä»¶
1. Chromeæµè§ˆå™¨å®‰è£…ï¼š
    * Video DownloadHelperï¼ˆæœ€æ¨èï¼‰
    * Flash Video Downloader
    * Stream Video Downloader
2. æ“ä½œæ­¥éª¤ï¼š
    * å®‰è£…æ’ä»¶åè®¿é—®è§†é¢‘é¡µé¢
    * æ’­æ”¾è§†é¢‘
    * æ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è§†é¢‘ï¼Œç‚¹å‡»ä¸‹è½½æŒ‰é’®å³å¯
æˆ–ä½¿ç”¨IDMï¼ˆInternet Download Managerï¼‰
* å®‰è£…IDMåï¼Œæ’­æ”¾è§†é¢‘æ—¶ä¼šè‡ªåŠ¨å¼¹å‡ºä¸‹è½½æµ®çª—
ğŸ”§ æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¸“é—¨çš„ä¸‹è½½å·¥å…·
å®‰è£…you-getï¼ˆæˆåŠŸç‡è¾ƒé«˜ï¼‰
bash
# å®‰è£…you-get
pip install you-get


# å°è¯•ä¸‹è½½
you-get https://v.qq.com/x/cover/mzc00200lwn6df7/w4101ousmww.html
æˆ–ä½¿ç”¨yt-dlpï¼ˆåŠŸèƒ½æ›´å¼ºå¤§ï¼‰
bash
# å®‰è£…yt-dlp
pip install yt-dlp


# å°è¯•ä¸‹è½½
yt-dlp https://v.qq.com/x/cover/mzc00200lwn6df7/w4101ousmww.html
ğŸ”§ æ–¹æ¡ˆ3ï¼šæŸ¥æ‰¾å…¶ä»–æ ¼å¼çš„è§†é¢‘æ–‡ä»¶
åœ¨Networké€‰é¡¹å¡ä¸­å°è¯•æœç´¢è¿™äº›å…³é”®è¯ï¼š
* index.m3u8 - æœ‰æ—¶åç§°ä¸åŒ
* .mp4 - ç›´æ¥æœç´¢mp4æ–‡ä»¶
* .ts - æœç´¢tsç‰‡æ®µ
* video - æœç´¢åŒ…å«videoçš„è¯·æ±‚
* play - æœç´¢æ’­æ”¾åœ°å€
* vkey - è…¾è®¯è§†é¢‘ç‰¹æœ‰çš„å‚æ•°
ğŸ”§ æ–¹æ¡ˆ4ï¼šä½¿ç”¨è¿™ä¸ªä¸“é—¨çš„è…¾è®¯è§†é¢‘ä¸‹è½½è„šæœ¬
è¿™é‡Œæ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹è…¾è®¯è§†é¢‘çš„ä¸‹è½½è„šæœ¬ï¼š
python
import re
import os
import json
import requests
from urllib.parse import urlparse, parse_qs
import subprocess
from pathlib import Path
import sys


class QQVideoDownloader:
    def __init__(self):
        self.headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'Referer': 'https://v.qq.com/'
        }
    
    def get_video_info(self, url):
        """è·å–è§†é¢‘ä¿¡æ¯"""
        try:
            # æå–è§†é¢‘ID
            parsed = urlparse(url)
            path_parts = parsed.path.split('/')
            
            # å°è¯•å¤šç§æ–¹å¼æå–ID
            video_id = None
            for part in path_parts:
                if part.endswith('.html'):
                    video_id = part.replace('.html', '')
                    break
            
            if not video_id and len(path_parts) > 0:
                video_id = path_parts[-1]
            
            print(f"è§†é¢‘ID: {video_id}")
            
            # å°è¯•è·å–è§†é¢‘ä¿¡æ¯API
            info_url = f"https://vv.video.qq.com/getinfo?vids={video_id}&platform=101001&charge=0&otype=json"
            
            response = requests.get(info_url, headers=self.headers, timeout=10)
            
            if response.status_code == 200:
                # è§£æJSONPå“åº”
                content = response.text
                if 'QZOutputJson=' in content:
                    json_str = content.split('QZOutputJson=', 1)[1].rsplit(';', 1)[0]
                    data = json.loads(json_str)
                    
                    if 'vl' in data:
                        vi = data['vl']['vi'][0]
                        title = vi['ti']  # æ ‡é¢˜
                        fn = vi['fn']     # æ–‡ä»¶å
                        fvkey = vi['fvkey']  # å¯†é’¥
                        
                        # è·å–è§†é¢‘æ’­æ”¾åœ°å€
                        url_prefix = vi['ul']['ui'][0]['url']
                        
                        print(f"æ ‡é¢˜: {title}")
                        print(f"æ–‡ä»¶: {fn}")
                        print(f"å¯†é’¥: {fvkey[:20]}...")
                        print(f"åœ°å€å‰ç¼€: {url_prefix}")
                        
                        # æ„é€ å®Œæ•´URL
                        video_url = f"{url_prefix}{fn}?vkey={fvkey}"
                        
                        return {
                            'title': title,
                            'url': video_url,
                            'filename': fn
                        }
            
            return None
            
        except Exception as e:
            print(f"è·å–è§†é¢‘ä¿¡æ¯å¤±è´¥: {e}")
            return None
    
    def download_video(self, url, save_path=None):
        """ä¸‹è½½è§†é¢‘"""
        if not save_path:
            save_path = Path.home() / 'Desktop'
        
        info = self.get_video_info(url)
        if not info:
            print("æ— æ³•è·å–è§†é¢‘ä¿¡æ¯")
            return False
        
        try:
            # æ¸…ç†æ–‡ä»¶å
            title = re.sub(r'[<>:"/\\|?*]', '', info['title'])
            filename = f"{title}.mp4"
            filepath = save_path / filename
            
            print(f"å¼€å§‹ä¸‹è½½: {title}")
            print(f"ä¿å­˜åˆ°: {filepath}")
            
            # ä¸‹è½½è§†é¢‘
            response = requests.get(info['url'], headers=self.headers, stream=True, timeout=30)
            response.raise_for_status()
            
            total_size = int(response.headers.get('content-length', 0))
            
            with open(filepath, 'wb') as f:
                downloaded = 0
                for chunk in response.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
                        downloaded += len(chunk)
                        
                        if total_size > 0:
                            percent = (downloaded / total_size) * 100
                            if downloaded % (1024*1024) == 0:  # æ¯1MBæ›´æ–°
                                print(f"è¿›åº¦: {downloaded//1024//1024}MB/{total_size//1024//1024}MB ({percent:.1f}%)")
            
            print(f"âœ… ä¸‹è½½å®Œæˆ: {filepath}")
            return True
            
        except Exception as e:
            print(f"ä¸‹è½½å¤±è´¥: {e}")
            return False


def main():
    """ä¸»å‡½æ•°"""
    print("="*60)
    print("è…¾è®¯è§†é¢‘ä¸“ç”¨ä¸‹è½½å™¨")
    print("="*60)
    
    # ä½¿ç”¨ä½ æä¾›çš„é“¾æ¥
    url = "https://v.qq.com/x/cover/mzc00200lwn6df7/w4101ousmww.html"
    
    print(f"ä¸‹è½½é“¾æ¥: {url}")
    print()
    
    downloader = QQVideoDownloader()
    
    # å…ˆå°è¯•è·å–ä¿¡æ¯
    print("æ­£åœ¨è·å–è§†é¢‘ä¿¡æ¯...")
    info = downloader.get_video_info(url)
    
    if info:
        print("\næ‰¾åˆ°è§†é¢‘ä¿¡æ¯ï¼Œå¼€å§‹ä¸‹è½½...")
        downloader.download_video(url)
    else:
        print("\næ— æ³•ç›´æ¥è·å–è§†é¢‘ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ...")
        
        # å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨you-get
        print("\nå°è¯•ä½¿ç”¨you-getä¸‹è½½...")
        try:
            # æ£€æŸ¥æ˜¯å¦å®‰è£…you-get
            result = subprocess.run(['you-get', '--version'], capture_output=True, text=True)
            if result.returncode == 0:
                print("ä½¿ç”¨you-getä¸‹è½½...")
                subprocess.run(['you-get', url])
            else:
                print("æœªå®‰è£…you-getï¼Œè¯·å…ˆå®‰è£…: pip install you-get")
        except:
            print("you-getæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…: pip install you-get")


if __name__ == '__main__':
    main()
    input("\næŒ‰Enteré”®é€€å‡º...")
ğŸ”§ æ–¹æ¡ˆ5ï¼šç»ˆææ–¹æ¡ˆ - ä½¿ç”¨ä¸“é—¨çš„è½¯ä»¶
å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½å¤±è´¥ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸“é—¨çš„è§†é¢‘ä¸‹è½½è½¯ä»¶ï¼š
1. ç¡•é¼ (FLVCD) - ä¸“é—¨ä¸‹è½½å›½å†…è§†é¢‘ç½‘ç«™
2. ç»´æ£ (VIDOWN) - æ”¯æŒè…¾è®¯è§†é¢‘
3. è¿…é›· - æœ‰æ—¶å¯ä»¥å—…æ¢åˆ°è§†é¢‘
ğŸš€ æ¨èçš„æ“ä½œé¡ºåº
æˆ‘å»ºè®®ä½ æŒ‰è¿™ä¸ªé¡ºåºå°è¯•ï¼š
ç¬¬ä¸€æ­¥ï¼ˆæœ€ç®€å•ï¼‰
bash
# å®‰è£…å¹¶è¿è¡Œyou-get
pip install you-get
you-get https://v.qq.com/x/cover/mzc00200
æœ¬å›ç­”ç”± AI ç”Ÿæˆï¼Œå†…å®¹ä»…ä¾›å‚è€ƒï¼Œè¯·ä»”ç»†ç”„åˆ«ã€‚
